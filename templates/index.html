{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<!-- Text Container -->
<div class="container-fluid text-container shadow p-3 mb-5 mt-4 bg-white rounded">
    <div class="row">
        <div class="col-md-12">
            <h2 class="sub-title">Welcome to BuzzEireBrazil!</h2>
            <p class="text">
                We are the first community where we gather people who provide services or in some way want to promote
                their business. The idea of the blog is to compile in posts what people can offer you. Since we are
                still a very young community, we plan to organize the posts by service categories in the near future.
                However, for now, as we don't have many categories, you can find them right here on the main page of the
                blog. Just search for what you're looking for or go to the next page if you haven't found it. If you
                still can't find it, right below, we have a box for you to leave a suggestion of what you were looking
                for, and we will organize it and leave it here for you to find when you return <br><br>
                The idea is to create a notification every time a post is added, but until then, feel free to visit us as many times as you'd like.
                br
            </p>
        </div>
    </div>
</div>

<!-- Blog Entries Container -->
<div class="container-fluid mt-5">
    <div class="row">
        <!-- Blog Entries Column -->
        <div class="col-12 mt-3 left">
            <div class="row">
                <h2 class="title"> Visit the post and leave a comment or feedback!!</h2>
                <h3 class="sub-title" >If you can't find what you're looking for, drop a comment in the suggestion section just below the posts.</h3>
                {% for post in post_list %}
                <div class="col-md-4 mt-5">
                    <div class="card mb-4 card-green-orange">
                        <div class="card-body">
                            <div class="image-container">
                                <!-- Featured Image -- Change the image, it's not a good one -->
                                {% if "placeholder" in post.featured_image.url %}
                                <img class="card-img-top"
                                    src="https://www.edublin.com.br/wp-content/uploads/2021/07/Green_harp_flag_of_Ireland_17th_century.svg-660x440.png">
                                {% else %}
                                <img class="card-img-top" src="{{ post.featured_image.url }}">
                                {% endif %}
                                <div class="image-flash">
                                    <!-- Author Information -->
                                    <p class="author">Author: {{ post.author }}</p>
                                </div>
                            </div>
                            <a href="{% url 'post_detail' post.slug %}" class="post-link">
                                <!-- Post Title and Excerpt -->
                                <h2 class="card-title">{{ post.title }}</h2>
                                <p class="card-text">{{ post.excerpt }}</p>
                            </a>
                            <hr />
                            <!-- Post Created Date and Likes -->
                            <p class="card-text text-muted h6">{{ post.created_on}} <i class="far fa-heart"></i>
                                {{ post.number_of_likes }}</p>
                        </div>
                    </div>
                </div>
                {% if forloop.counter|divisibleby:3 %}
            </div>
            <div class="row">
                {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Pagination -->
        {% if is_paginated %}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li><a href="?page={{ page_obj.previous_page_number }}" class="page-link">&laquo; PREV </a></li>
                {% endif %}
                {% if page_obj.has_next %}
                <li><a href="?page={{ page_obj.next_page_number }}" class="page-link"> NEXT &raquo;</a></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        <br>
    </div>
</div>

<!-- User Suggestion Section -->
<!-- User Suggestion Section -->
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-12">
            <!-- Suggestion Form -->
            <h3 class="brand">What would you like to see here at <strong>BuzzEireBrazil</strong>?</h3>
            <!-- Suggestion Submission Form -->
            {% if user.is_authenticated %}
            <form method="post" action="{% url 'submit_suggestion' %}">
                {% csrf_token %}
                {{ suggestion_form.suggestion_text.label_tag }}
                <textarea name="suggestion_text" id="id_suggestion_text" rows="4" cols="50">
                    {{ suggestion_form.suggestion_text.value|default:""}}</textarea>
                    <button type="submit" class="btn btn-submit mt-1">Submit</button>
                {% if suggestion_form.errors.suggestion_text %}
                <p class="error">{{ suggestion_form.errors.suggestion_text }}</p>
                {% endif %}
            </form>

            <!-- Suggestions List -->
            <ul class="list-group mt-4">
                {% for suggestion in suggestions %}
                <li class="list-group-item suggestion-item">
                    <div class="suggestion-text">
                        {{ suggestion.suggestion_text }}
                    </div>
                    <div class="suggestion-details text-muted">
                        Suggested by {{ suggestion.user.username }} on {{ suggestion.created_on }}
                    </div>
                    <div class="suggestion-actions mt-2">
                        <!-- Like button for suggestions -->
                        <form class="d-inline" action="{% url 'suggestion_like' suggestion.id %}" method="POST">
                            {% csrf_token %}
                            {% if user in suggestion.likes.all %}
                            <button type="submit" name="liked" value="unliked" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-thumbs-up"></i>
                            </button>
                            {% else %}
                            <button type="submit" name="liked" value="liked" class="btn btn-sm btn-outline-secondary">
                                <i class="far fa-thumbs-up"></i>
                            </button>
                            {% endif %}
                        </form>
                        <span class="likes">{{ suggestion.total_likes }}</span>
            
                        <!-- Dislike button for suggestions -->
                        <form class="d-inline" action="{% url 'suggestion_dislike' suggestion.id %}" method="POST">
                            {% csrf_token %}
                            {% if user in suggestion.dislikes.all %}
                            <button type="submit" name="disliked" value="undisliked" class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-thumbs-down"></i>
                            </button>
                            {% else %}
                            <button type="submit" name="disliked" value="disliked" class="btn btn-sm btn-outline-secondary">
                                <i class="far fa-thumbs-down"></i>
                            </button>
                            {% endif %}
                        </form>
                        <span class="dislikes">{{ suggestion.total_dislikes }}</span>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>
</div>

<!-- Comment Section -->
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="comments">
                {% for comment in comments %}
                <div class="comment card mb-3">
                    <div class="card-body">
                        <h5 class="card-title comment-author">{{ comment.name }} <small
                                class="text-muted">{{ comment.created_on }}</small></h5>
                        <p class="card-text comment-body">{{ comment.body | linebreaks }}</p>

                        <!-- Like and Dislike buttons for comments -->
                        {% include 'blog/comment_buttons.html' %}

                        <!-- Edit button -->
                        {% if user.is_authenticated and user == comment.user %}
                        <a href="{% url 'edit_comment' comment.id %}" class="btn btn-sm btn-warning">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        {% endif %}

                        <!-- Delete button -->
                        {% if user.is_authenticated and user == comment.user %}
                        <form class="d-inline" action="{% url 'delete_comment' comment.id %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <!-- Comment Approval Alert -->
            {% if commented %}
            <div class="alert alert-success" role="alert">
                Your comment is awaiting approval
            </div>
            {% else %}
            <!-- End of Comment Section -->
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var suggestionText = document.getElementById('id_suggestion_text');

        suggestionText.addEventListener('focus', function () {
            if (this.value === 'Tell me what you are thinking...') {
                this.value = '';
            }
        });

        suggestionText.addEventListener('blur', function () {
            if (this.value === '') {
                this.value = 'Tell me what you are thinking...';
            }
        });
    });
</script>
{% endblock content %}
